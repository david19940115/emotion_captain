<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>æƒ…ç·’éšŠé•·</title>
  
  <!-- 1. å¼•å…¥ Tailwind CSS (æ¨£å¼) -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- 2. å¼•å…¥ React æ ¸å¿ƒ -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- 3. å¼•å…¥ Babel (è®“ç€è¦½å™¨çœ‹å¾—æ‡‚ JSX) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    /* é˜²æ­¢æ‰‹æ©Ÿä¸Šä¸‹æ»‘å‹•çš„å½ˆæ€§æ•ˆæœï¼Œè®“å®ƒæ›´åƒ App */
    body { overscroll-behavior-y: none; }
    /* å‹•ç•«è¨­å®š */
    @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slide-up { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes bounce-in { 
      0% { transform: scale(0.8); opacity: 0; } 
      60% { transform: scale(1.1); opacity: 1; } 
      100% { transform: scale(1); } 
    }
    .animate-fade-in { animation: fade-in 0.5s ease-out; }
    .animate-slide-up { animation: slide-up 0.5s ease-out; }
    .animate-bounce-in { animation: bounce-in 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    /* ç¿»ç‰Œæ•ˆæœ */
    .rotate-y-180 { transform: rotateY(180deg); }
  </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans select-none">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // --- å…§å»ºåœ–ç¤º SVG (å–ä»£ Lucide ä¾è³´ï¼Œç¢ºä¿é›¢ç·šå¯ç”¨) ---
    const IconBase = ({ size = 24, children, className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        {children}
      </svg>
    );

    const Home = (props) => <IconBase {...props}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></IconBase>;
    const ArrowLeft = (props) => <IconBase {...props}><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></IconBase>;
    const Activity = (props) => <IconBase {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></IconBase>;
    const BookOpen = (props) => <IconBase {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></IconBase>;
    const Heart = (props) => <IconBase {...props}><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></IconBase>;
    const Trophy = (props) => <IconBase {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17"></path><path d="M14 14.66V17"></path><rect x="6" y="6" width="12" height="10" rx="3"></rect><path d="M12 22a2 2 0 0 0 2-2H8a2 2 0 0 0 2 2z"></path></IconBase>;
    const RefreshCw = (props) => <IconBase {...props}><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></IconBase>;
    const Star = (props) => <IconBase {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></IconBase>;

    // --- è‡ªè¨‚è§’è‰² SVG å…ƒä»¶ (è…¦ç­‹æ€¥è½‰å½é¢¨æ ¼) ---

    const JoyIcon = ({ size = 48 }) => (
      <svg width={size} height={size} viewBox="0 0 100 100" className="overflow-visible">
        <circle cx="50" cy="50" r="45" fill="#FDE047" stroke="#F59E0B" strokeWidth="2" />
        <path d="M50 5 L60 25 L80 20 L70 40 L85 55 L65 50 L50 65 L35 50 L15 55 L30 40 L20 20 L40 25 Z" fill="#3B82F6" />
        <circle cx="35" cy="55" r="5" fill="#374151" />
        <circle cx="65" cy="55" r="5" fill="#374151" />
        <path d="M30 70 Q50 85 70 70" stroke="#374151" strokeWidth="3" fill="none" strokeLinecap="round" />
        <circle cx="20" cy="65" r="5" fill="#FCA5A5" opacity="0.6" />
        <circle cx="80" cy="65" r="5" fill="#FCA5A5" opacity="0.6" />
      </svg>
    );

    const SadnessIcon = ({ size = 48 }) => (
      <svg width={size} height={size} viewBox="0 0 100 100" className="overflow-visible">
        <circle cx="50" cy="50" r="45" fill="#93C5FD" stroke="#60A5FA" strokeWidth="2" />
        <path d="M20 30 Q50 80 80 30 Q50 10 20 30" fill="#1E40AF" opacity="0.9" />
        <g stroke="#1E3A8A" strokeWidth="3" fill="none">
          <circle cx="35" cy="55" r="14" />
          <circle cx="65" cy="55" r="14" />
          <line x1="49" y1="55" x2="51" y2="55" />
        </g>
        <circle cx="35" cy="55" r="3" fill="#1E3A8A" />
        <circle cx="65" cy="55" r="3" fill="#1E3A8A" />
        <path d="M42 80 Q50 75 58 80" stroke="#1E3A8A" strokeWidth="3" fill="none" strokeLinecap="round" />
      </svg>
    );

    const AngerIcon = ({ size = 48 }) => (
      <svg width={size} height={size} viewBox="0 0 100 100" className="overflow-visible">
        <rect x="15" y="25" width="70" height="65" rx="12" fill="#EF4444" stroke="#B91C1C" strokeWidth="2" />
        <path d="M15 25 L25 5 L35 20 L50 0 L65 20 L75 5 L85 25 Z" fill="#F59E0B" />
        <path d="M25 45 L45 55" stroke="#7F1D1D" strokeWidth="5" strokeLinecap="round" />
        <path d="M75 45 L55 55" stroke="#7F1D1D" strokeWidth="5" strokeLinecap="round" />
        <circle cx="35" cy="60" r="4" fill="#333" />
        <circle cx="65" cy="60" r="4" fill="#333" />
        <path d="M35 75 Q50 72 65 75" stroke="#333" strokeWidth="3" fill="none" />
        <path d="M35 75 L35 78 L65 78 L65 75" fill="white" />
      </svg>
    );

    const FearIcon = ({ size = 48 }) => (
      <svg width={size} height={size} viewBox="0 0 100 100" className="overflow-visible">
        <ellipse cx="50" cy="50" rx="30" ry="48" fill="#C084FC" stroke="#9333EA" strokeWidth="2" />
        <path d="M50 2 Q55 10 52 15" stroke="#6B21A8" strokeWidth="3" fill="none" strokeLinecap="round" />
        <circle cx="40" cy="45" r="10" fill="white" stroke="#6B21A8" strokeWidth="1" />
        <circle cx="60" cy="45" r="10" fill="white" stroke="#6B21A8" strokeWidth="1" />
        <circle cx="40" cy="45" r="3" fill="#333" />
        <circle cx="60" cy="45" r="3" fill="#333" />
        <path d="M40 35 Q35 30 30 35" stroke="#6B21A8" strokeWidth="2" fill="none" />
        <path d="M60 35 Q65 30 70 35" stroke="#6B21A8" strokeWidth="2" fill="none" />
        <ellipse cx="50" cy="75" rx="6" ry="8" fill="#333" />
        <path d="M45 90 L55 90 L55 98 L45 98 Z" fill="#EF4444" />
        <path d="M45 94 L35 88 L35 100 L45 94 Z" fill="#EF4444" />
        <path d="M55 94 L65 88 L65 100 L55 94 Z" fill="#EF4444" />
      </svg>
    );

    const DisgustIcon = ({ size = 48 }) => (
      <svg width={size} height={size} viewBox="0 0 100 100" className="overflow-visible">
        <circle cx="50" cy="50" r="42" fill="#4ADE80" stroke="#16A34A" strokeWidth="2" />
        <path d="M20 35 Q50 5 80 35" fill="#15803D" />
        <path d="M80 35 Q85 50 82 60" fill="#15803D" />
        <path d="M28 45 L42 50" stroke="#14532D" strokeWidth="2" strokeLinecap="round" />
        <path d="M72 45 L58 50" stroke="#14532D" strokeWidth="2" strokeLinecap="round" />
        <circle cx="38" cy="55" r="4" fill="#14532D" />
        <circle cx="62" cy="55" r="4" fill="#14532D" />
        <path d="M42 75 Q50 70 58 75" stroke="#14532D" strokeWidth="3" fill="none" strokeLinecap="round" />
        <path d="M30 85 Q50 95 70 85" stroke="#D946EF" strokeWidth="6" fill="none" strokeLinecap="round" />
      </svg>
    );

    // --- è³‡æ–™è¨­å®š ---

    const emotions = [
      { 
        id: 'joy', 
        label: 'å¿«æ¨‚', 
        color: 'bg-yellow-100', 
        textColor: 'text-yellow-800',
        icon: <JoyIcon />, 
        desc: 'åƒæ¨‚æ¨‚ä¸€æ¨£ï¼è¦ºå¾—ä¸–ç•Œé–ƒé–ƒç™¼å…‰ï¼Œå……æ»¿æ´»åŠ›ï¼',
        tip: 'æŠŠé€™ä»½é–‹å¿ƒå‚³æŸ“çµ¦éšŠå‹ï¼Œç¬‘å®¹æ˜¯æœ€å¥½çš„åŠ©æ”»ï¼'
      },
      { 
        id: 'sadness', 
        label: 'æ†‚å‚·', 
        color: 'bg-blue-100', 
        textColor: 'text-blue-900',
        icon: <SadnessIcon />, 
        desc: 'åƒæ†‚æ†‚ä¸€æ¨£ã€‚è¦ºå¾—å¿ƒè£¡è—è—çš„ï¼Œç”šè‡³æƒ³å“­ä¸€ä¸‹ã€‚',
        tip: 'çœ¼æ·šæ˜¯å¿ƒéˆçš„æ±—æ°´ï¼Œå“­å‡ºä¾†æ²’é—œä¿‚ï¼Œä¼‘æ¯ä¸€ä¸‹å†å‡ºç™¼ã€‚'
      },
      { 
        id: 'anger', 
        label: 'æ†¤æ€’', 
        color: 'bg-red-100', 
        textColor: 'text-red-900',
        icon: <AngerIcon />, 
        desc: 'åƒæ€’æ€’ä¸€æ¨£ï¼è¦ºå¾—é ­é ‚å†’ç«ï¼Œè¦ºå¾—äº‹æƒ…ä¸å…¬å¹³ï¼',
        tip: 'ä½ å¯ä»¥å­¸è·ç±ƒå–Šæš«åœ60ç§’ï¼Œæˆ–çŸ­æš«åœ30ç§’ï¼Œæ·±å‘¼å¸ï¼Œåˆ¥è®“å¿ƒä¸­çš„ç«ç‡’å‚·åˆ¥äººã€‚'
      },
      { 
        id: 'fear', 
        label: 'é©šåš‡', 
        color: 'bg-purple-100', 
        textColor: 'text-purple-900',
        icon: <FearIcon />, 
        desc: 'åƒé©šé©šä¸€æ¨£ã€‚è¦ºå¾—ç¥ç¶“ç·Šç¹ƒï¼Œæƒ³æ‰¾åœ°æ–¹èº²èµ·ä¾†ã€‚',
        tip: 'å®³æ€•æ˜¯åœ¨ä¿è­·æˆ‘å€‘ï¼Œæ·±å‘¼å¸å‘Šè¨´è‡ªå·±ï¼šã€Œæˆ‘ä¸å­¤å–®ï¼Œæˆ‘æœ‰å‹‡æ°£é¢å°ã€ã€‚'
      },
      { 
        id: 'disgust', 
        label: 'å­æƒ¡', 
        color: 'bg-green-100', 
        textColor: 'text-green-900',
        icon: <DisgustIcon />, 
        desc: 'åƒå­å­ä¸€æ¨£ã€‚è¦ºå¾—å™å¿ƒã€è¨å­ï¼Œä¸æƒ³é è¿‘é‚£äº›äººæˆ–äº‹ã€‚',
        tip: 'è©¦è‘—ç”¨è¨€èªèªªå‡ºä½ ä¸å–œæ­¡çš„åŸå› ï¼Œè¨­ç«‹å¥åº·çš„ç•Œç·šã€‚'
      },
    ];

    const davidAdviceText = "è£åˆ¤è€å¸«æœƒç­‰ä½ ï¼Œæº–å‚™å¥½æƒ…ç·’å†å‡ºæ‰‹ã€‚";

    // --- å…ƒä»¶ï¼šä¸»é¸å–® ---
    const MainMenu = ({ onNavigate }) => {
      return (
        <div className="flex flex-col items-center justify-center h-full space-y-6 p-6 animate-fade-in">
          <header className="text-center mb-4">
            <h1 className="text-4xl font-bold text-indigo-600 mb-2 drop-shadow-sm">æƒ…ç·’éšŠé•·</h1>
            <p className="text-gray-500 text-lg">æˆç‚ºè‡ªå·±æƒ…ç·’çš„éšŠé•·ï¼</p>
          </header>

          <div className="grid grid-cols-2 gap-4 w-full max-w-md">
            <MenuButton title="æƒ…ç·’ç°½åˆ°" icon={<Activity size={32} />} color="bg-orange-100 hover:bg-orange-200 text-orange-600" onClick={() => onNavigate('checkin')} />
            <MenuButton title="èªè­˜æƒ…ç·’" icon={<BookOpen size={32} />} color="bg-sky-100 hover:bg-sky-200 text-sky-600" onClick={() => onNavigate('learn')} />
            <MenuButton title="å†·éœç·´ç¿’" icon={<Heart size={32} />} color="bg-rose-100 hover:bg-rose-200 text-rose-600" onClick={() => onNavigate('calm')} />
            <MenuButton title="è¨˜æ†¶éŠæˆ²" icon={<Trophy size={32} />} color="bg-emerald-100 hover:bg-emerald-200 text-emerald-600" onClick={() => onNavigate('game')} />
          </div>
          
          <div className="mt-8 p-4 bg-white/80 rounded-xl shadow-sm border border-indigo-100 max-w-md w-full">
            <p className="text-indigo-800 text-center text-sm font-medium">
              ğŸ’¡ å¤§è¡›è€å¸«å°å®åš€ï¼šäººéƒ½æœƒæœ‰æƒ…ç·’ï¼Œé‡è¦çš„æ˜¯æˆ‘å€‘å¦‚ä½•é¢å°å®ƒã€‚
            </p>
          </div>
        </div>
      );
    };

    const MenuButton = ({ title, icon, color, onClick }) => (
      <button onClick={onClick} className={`${color} p-6 rounded-2xl shadow-md transition-all transform hover:scale-105 active:scale-95 flex flex-col items-center justify-center gap-3 h-40 border-2 border-transparent hover:border-white/50`}>
        <div className="bg-white/50 p-3 rounded-full">{icon}</div>
        <span className="font-bold text-lg">{title}</span>
      </button>
    );

    // --- å…ƒä»¶ï¼šæƒ…ç·’ç°½åˆ° ---
    const CheckInScreen = ({ onBack }) => {
      const [selected, setSelected] = useState(null);

      return (
        <div className="flex flex-col h-full p-4 animate-slide-up">
          <NavBar title="ä»Šå¤©æ„Ÿè¦ºå¦‚ä½•ï¼Ÿ" onBack={onBack} />
          
          <div className="flex-1 flex flex-col items-center justify-center">
            {selected ? (
              <div className="text-center space-y-6 animate-bounce-in">
                <div className={`p-8 rounded-full inline-block ${emotions.find(e => e.id === selected).color} shadow-lg border-4 border-white`}>
                  {React.cloneElement(emotions.find(e => e.id === selected).icon, { size: 100 })}
                </div>
                <h2 className="text-3xl font-bold text-gray-700">
                  ä½ ç¾åœ¨è¦ºå¾—{emotions.find(e => e.id === selected).label}
                </h2>
                <p className="text-gray-500 text-xl px-8">
                  {emotions.find(e => e.id === selected).tip}
                </p>
                <button 
                  onClick={() => setSelected(null)}
                  className="mt-8 px-8 py-3 bg-indigo-500 text-white rounded-full font-bold shadow-lg active:scale-95 transition-transform"
                >
                  é‡æ–°é¸æ“‡
                </button>
              </div>
            ) : (
              <div className="grid grid-cols-2 gap-4 w-full max-w-sm">
                {emotions.map((mood) => (
                  <button
                    key={mood.id}
                    onClick={() => setSelected(mood.id)}
                    className={`${mood.color} ${mood.textColor} p-4 rounded-xl shadow-md transform hover:scale-105 transition-all flex flex-col items-center justify-center gap-2 h-36 border border-white/50`}
                  >
                    {React.cloneElement(mood.icon, { size: 60 })}
                    <span className="font-bold text-lg mt-2">{mood.label}</span>
                  </button>
                ))}
              </div>
            )}
          </div>
        </div>
      );
    };

    // --- å…ƒä»¶ï¼šèªè­˜æƒ…ç·’ ---
    const LearnScreen = ({ onBack }) => {
      const [activeIndex, setActiveIndex] = useState(0);

      return (
        <div className="flex flex-col h-full p-4 animate-slide-up">
          <NavBar title="æƒ…ç·’åœ–é‘‘" onBack={onBack} />
          
          <div className="flex-1 flex items-center justify-center">
            <div className="w-full max-w-sm bg-white rounded-3xl shadow-xl overflow-hidden border border-gray-100">
              <div className={`${emotions[activeIndex].color} p-10 flex justify-center items-center transition-colors duration-500`}>
                <div className="bg-white/40 p-6 rounded-full backdrop-blur-sm shadow-inner">
                  {React.cloneElement(emotions[activeIndex].icon, { size: 120 })}
                </div>
              </div>
              
              <div className="p-6 text-center space-y-4">
                <h2 className={`text-3xl font-bold ${emotions[activeIndex].textColor}`}>
                  {emotions[activeIndex].label}
                </h2>
                <p className="text-gray-600 text-lg leading-relaxed min-h-[3rem]">
                  {emotions[activeIndex].desc}
                </p>
                <div className="bg-gray-50 p-4 rounded-xl border border-gray-100">
                  <span className="text-sm text-gray-400 font-bold uppercase tracking-wider">å¤§è¡›è€å¸«å»ºè­°</span>
                  <p className="text-indigo-600 font-medium mt-1">{emotions[activeIndex].tip}</p>
                </div>
              </div>

              <div className="flex justify-between p-4 bg-gray-50 border-t border-gray-100">
                 <button 
                  disabled={activeIndex === 0}
                  onClick={() => setActiveIndex(i => i - 1)}
                  className="p-2 rounded-full hover:bg-gray-200 disabled:opacity-30 transition"
                 >
                   <ArrowLeft size={24} />
                 </button>
                 <div className="flex gap-2 items-center">
                   {emotions.map((_, idx) => (
                     <div key={idx} className={`w-2 h-2 rounded-full ${idx === activeIndex ? 'bg-indigo-500 w-4' : 'bg-gray-300'} transition-all`} />
                   ))}
                 </div>
                 <button 
                  disabled={activeIndex === emotions.length - 1}
                  onClick={() => setActiveIndex(i => i + 1)}
                  className="p-2 rounded-full hover:bg-gray-200 disabled:opacity-30 transition rotate-180"
                 >
                   <ArrowLeft size={24} />
                 </button>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // --- å…ƒä»¶ï¼šå†·éœç·´ç¿’ ---
    const CalmScreen = ({ onBack }) => {
      const [phase, setPhase] = useState('ready');
      const [counter, setCounter] = useState(0);

      useEffect(() => {
        let timer;
        if (phase === 'inhale') {
          if (counter < 4) timer = setTimeout(() => setCounter(c => c + 1), 1000);
          else { setPhase('hold'); setCounter(4); }
        } else if (phase === 'hold') {
          if (counter > 0) timer = setTimeout(() => setCounter(c => c - 1), 1000);
          else { setPhase('exhale'); setCounter(0); }
        } else if (phase === 'exhale') {
          if (counter < 6) timer = setTimeout(() => setCounter(c => c + 1), 1000);
          else { setPhase('ready'); setCounter(0); }
        }
        return () => clearTimeout(timer);
      }, [phase, counter]);

      const startBreathing = () => {
        setPhase('inhale');
        setCounter(0);
      };

      const getInstruction = () => {
        switch(phase) {
          case 'ready': return <span className="block leading-snug">ä½ è¢«çŠ¯è¦äº†ï¼Œ<br/>æº–å‚™å¥½é–‹å§‹ç½°çƒæ·±å‘¼å¸äº†å—ï¼Ÿ</span>;
          case 'inhale': return 'ç”¨é¼»å­å¸æ°£...(é‹çƒä¸€ä¸‹)';
          case 'hold': return 'é–‰æ°£...(ç„æº–ç±ƒæ¡†)';
          case 'exhale': return 'ç”¨å˜´å·´åæ°£...(å‡ºæ‰‹ï¼é€²ï¼)';
          default: return '';
        }
      };

      const getCircleSize = () => {
        if (phase === 'ready') return 'scale-100';
        if (phase === 'inhale') return 'scale-150';
        if (phase === 'hold') return 'scale-150';
        if (phase === 'exhale') return 'scale-100';
        return 'scale-100';
      };

      return (
        <div className="flex flex-col h-full p-4 animate-slide-up bg-gradient-to-b from-indigo-50 to-white">
          <NavBar title="å†·éœç·´ç¿’å®¤" onBack={onBack} />
          
          <div className="flex-1 flex flex-col items-center justify-center space-y-12">
            <div className="relative">
               <div 
                 className={`w-48 h-48 rounded-full bg-orange-500 border-4 border-orange-600 flex items-center justify-center shadow-2xl transition-transform duration-1000 ease-in-out ${getCircleSize()}`}
                 style={{ 
                   backgroundImage: 'radial-gradient(circle at 30% 30%, #fb923c, #ea580c)',
                   boxShadow: phase === 'hold' ? '0 0 30px rgba(234, 88, 12, 0.6)' : '0 10px 15px -3px rgba(0, 0, 0, 0.1)'
                 }}
               >
                 <div className="absolute w-full h-[2px] bg-orange-800 opacity-40"></div>
                 <div className="absolute h-full w-[2px] bg-orange-800 opacity-40"></div>
                 <div className="absolute w-32 h-32 rounded-full border-[2px] border-orange-800 opacity-40"></div>

                 <span className="text-white text-4xl font-bold drop-shadow-md relative z-10">
                   {phase !== 'ready' ? (phase === 'hold' ? 'Hold' : counter) : 'Start'}
                 </span>
               </div>
            </div>

            <div className="text-center space-y-4 max-w-xs">
              <h3 className="text-2xl font-bold text-gray-700 min-h-[2rem] transition-all">
                {getInstruction()}
              </h3>
              
              {phase === 'ready' && (
                <button 
                  onClick={startBreathing}
                  className="px-8 py-3 bg-indigo-600 text-white rounded-full font-bold shadow-lg hover:bg-indigo-700 transition active:scale-95"
                >
                  é–‹å§‹ç½°çƒ
                </button>
              )}
            </div>

            <div className="mt-8 bg-white p-6 rounded-2xl shadow-md border-l-4 border-yellow-400 max-w-sm w-full mx-4">
              <div className="flex items-center gap-2 mb-2 text-yellow-600">
                <Star size={20} fill="currentColor" />
                <span className="font-bold text-sm uppercase">å¤§è¡›è€å¸«å»ºè­°</span>
              </div>
              <p className="text-gray-800 font-medium text-lg mb-2 leading-relaxed">
                {davidAdviceText}
              </p>
            </div>
          </div>
        </div>
      );
    };

    // --- å…ƒä»¶ï¼šè¨˜æ†¶éŠæˆ² ---
    const GameScreen = ({ onBack }) => {
      const [cards, setCards] = useState([]);
      const [flipped, setFlipped] = useState([]);
      const [solved, setSolved] = useState([]);
      const [disabled, setDisabled] = useState(false);
      const [won, setWon] = useState(false);

      useEffect(() => {
        initializeGame();
      }, []);

      const initializeGame = () => {
        const gameItems = [...emotions, ...emotions]
          .sort(() => Math.random() - 0.5)
          .map((item) => ({ ...item, uniqueId: Math.random() }));
        
        setCards(gameItems);
        setFlipped([]);
        setSolved([]);
        setWon(false);
        setDisabled(false);
      };

      const handleClick = (id) => {
        if (disabled || won) return;
        if (flipped.length === 0) {
          setFlipped([id]);
          return;
        }
        if (flipped.length === 1) {
          if (id === flipped[0]) return;
          setDisabled(true);
          setFlipped([...flipped, id]);
          
          const firstCard = cards.find(card => card.uniqueId === flipped[0]);
          const secondCard = cards.find(card => card.uniqueId === id);

          if (firstCard.id === secondCard.id) {
            setSolved([...solved, flipped[0], id]);
            setFlipped([]);
            setDisabled(false);
          } else {
            setTimeout(() => {
              setFlipped([]);
              setDisabled(false);
            }, 1000);
          }
        }
      };

      useEffect(() => {
        if (cards.length > 0 && solved.length === cards.length) {
          setWon(true);
        }
      }, [solved, cards]);

      return (
        <div className="flex flex-col h-full p-4 animate-slide-up">
          <NavBar title="æƒ…ç·’é…å°è³½" onBack={onBack} />
          
          <div className="flex-1 flex flex-col items-center justify-center">
            {won ? (
              <div className="text-center animate-bounce-in bg-white p-8 rounded-3xl shadow-xl">
                <Trophy size={80} className="text-yellow-500 mx-auto mb-4" />
                <h2 className="text-3xl font-bold text-gray-800 mb-2">å¤ªæ£’äº†ï¼</h2>
                <p className="text-gray-500 mb-6">ä½ æˆåŠŸè¾¨è­˜äº†æ‰€æœ‰æƒ…ç·’ï¼</p>
                <button 
                  onClick={initializeGame}
                  className="flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-full font-bold shadow-lg mx-auto hover:bg-indigo-700"
                >
                  <RefreshCw size={20} />
                  å†ä¾†ä¸€å ´
                </button>
              </div>
            ) : (
              <div className="grid grid-cols-4 gap-3 w-full max-w-md aspect-square">
                {cards.map((card) => (
                  <div 
                    key={card.uniqueId}
                    onClick={() => !flipped.includes(card.uniqueId) && !solved.includes(card.uniqueId) && handleClick(card.uniqueId)}
                    className={`relative cursor-pointer transition-all duration-300 transform ${
                      flipped.includes(card.uniqueId) || solved.includes(card.uniqueId) 
                        ? 'rotate-y-180' 
                        : 'hover:scale-105'
                    }`}
                  >
                    <div className={`w-full h-20 sm:h-24 rounded-xl flex items-center justify-center shadow-md transition-all duration-300 ${
                      flipped.includes(card.uniqueId) || solved.includes(card.uniqueId) 
                       ? `bg-white border-2 border-indigo-200` 
                       : 'bg-indigo-500'
                    }`}>
                      {flipped.includes(card.uniqueId) || solved.includes(card.uniqueId) ? (
                        <div className="animate-fade-in flex items-center justify-center">
                          {React.cloneElement(card.icon, { size: 40 })}
                        </div>
                      ) : (
                        <span className="text-white font-bold text-2xl">?</span>
                      )}
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>
      );
    };

    // --- é€šç”¨å…ƒä»¶ ---
    const NavBar = ({ title, onBack }) => (
      <div className="flex items-center gap-4 mb-6">
        <button onClick={onBack} className="p-2 bg-white rounded-full shadow-sm text-gray-600 hover:bg-gray-100 transition">
          <ArrowLeft size={24} />
        </button>
        <h1 className="text-2xl font-bold text-gray-800">{title}</h1>
      </div>
    );

    // --- ä¸»ç¨‹å¼å…¥å£ ---
    const App = () => {
      const [screen, setScreen] = useState('home');

      const renderScreen = () => {
        switch(screen) {
          case 'checkin': return <CheckInScreen onBack={() => setScreen('home')} />;
          case 'learn': return <LearnScreen onBack={() => setScreen('home')} />;
          case 'calm': return <CalmScreen onBack={() => setScreen('home')} />;
          case 'game': return <GameScreen onBack={() => setScreen('home')} />;
          default: return <MainMenu onNavigate={setScreen} />;
        }
      };

      return (
        <div className="min-h-screen bg-slate-50 font-sans text-slate-900 selection:bg-indigo-100 flex justify-center">
          <div className="w-full max-w-lg bg-white min-h-screen shadow-2xl overflow-hidden relative border-x border-gray-100">
            <div className="absolute top-0 left-0 w-64 h-64 bg-blue-100 rounded-full mix-blend-multiply filter blur-3xl opacity-30 -translate-x-1/2 -translate-y-1/2 pointer-events-none"></div>
            <div className="absolute bottom-0 right-0 w-64 h-64 bg-pink-100 rounded-full mix-blend-multiply filter blur-3xl opacity-30 translate-x-1/2 translate-y-1/2 pointer-events-none"></div>
            <div className="relative z-10 h-full">
               {renderScreen()}
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
